#include<stdio.h>
//interpolateDataPoints.c

//return interpolated value
double interpolate(double x, double mxb[][3], unsigned long int nMxb){
  //return 0 if x is not in bounds, assuming points are ordered
  if(x<mxb[0][0] || x>mxb[nMxb-1][0])
    return 0;

  //find the region boundary to the left of x
  int lowerXBoundaryIndex=0;
  while(x>=mxb[lowerXBoundaryIndex+1][0]) //lowerXBoundaryIndex+1 = upper bound index
    lowerXBoundaryIndex++;

  //y=mx+b
  double m=mxb[lowerXBoundaryIndex][1];
  double b=mxb[lowerXBoundaryIndex][2];

  return m*x+b;
}

int main(){
  //set slope/intercepts for y=mx+b fit for every set of points
  //{<min resistance range>, <slope>, <intercept>}
  double mxb[][3]={
    {1.15866529715041E+03,-0.340313,439.338928},
    {1.16746663791400E+03,-0.308539,402.243652},
    {1.17721235255750E+03,-0.278462,366.837402},
    {1.18800973618585E+03,-0.255010,338.975739},
    {1.19978259001363E+03,-0.228635,307.330872},
    {1.20900330938726E+03,-0.214116,289.778290},
    {1.21743885586541E+03,-0.199806,272.355988},
    {1.22550149791847E+03,-0.185126,254.366226},
    {1.23416244962562E+03,-0.172063,238.244339},
    {1.24339517040247E+03,-0.161660,225.309021},
    {1.25325132686766E+03,-0.148243,208.494171},
    {1.26396964606193E+03,-0.136087,193.129486},
    {1.27187950977041E+03,-0.131005,186.666183},
    {1.27936384189714E+03,-0.124449,178.277603},
    {1.28722934127037E+03,-0.115420,166.655228},
    {1.29574759047070E+03,-0.110651,160.476547},
    {1.30462105050847E+03,-0.101158,148.092117},
    {1.31442017104110E+03,-0.096486,141.950424},
    {1.32472218300874E+03,-0.089150,132.232162},
    {1.33594976105827E+03,-0.082588,123.466324},
    {1.34817125459252E+03,-0.076413,115.141617},
    {1.36144449280113E+03,-0.070118,106.570900},
    {1.37599419281473E+03,-0.064365,98.654922},
    {1.39183479639045E+03,-0.057651,89.309853},
    {1.40954426489785E+03,-0.050587,79.352158},
    {1.42966395040817E+03,-0.044167,70.174049},
    {1.44803071964235E+03,-0.038788,62.385815},
    {1.46639736561052E+03,-0.033650,54.851604},
    {1.48143361599810E+03,-0.030270,49.844269},
    {1.49482205096690E+03,-0.026994,44.947224},
    {1.50928139937351E+03,-0.025001,41.938580},
    {1.51749647765215E+03,-0.023347,39.428421},
    {1.52600538164916E+03,-0.021540,36.671700},
    {1.53504308357240E+03,-0.019657,33.780666},
    {1.54521806346207E+03,-0.018765,32.403214},
    {1.55621166365908E+03,-0.017065,29.756313},
    {1.56790219236253E+03,-0.015397,27.141584},
    {1.58077863430236E+03,-0.013923,24.811394},
    {1.59568104326293E+03,-0.012480,22.509581},
    {1.61102290744041E+03,-0.011076,20.247211},
    {1.62935054078325E+03,-0.009767,18.113834},
    {1.64976915441758E+03,-0.008411,15.876504},
    {1.67349179538564E+03,-0.007134,13.740522},
    {1.70155732512926E+03,-0.005854,11.562836},
    {1.73591860654589E+03,-0.005043,10.153995},
    {1.75474906703357E+03,-0.004533,9.259174},
    {1.77769752561913E+03,-0.004017,8.341838},
    {1.79063000000000E+03,-0.003609,7.610822},
    {1.81829000000000E+03,-0.003166,6.805555},
    {1.84970000000000E+03,-0.002745,6.027423},
    {1.88391000000000E+03,-0.002307,5.201397},
    {1.92307000000000E+03,-0.001974,4.561033},
    {1.96321000000000E+03,-0.001644,3.914460},
    {2.00894000000000E+03,-0.001381,3.386529},
    {2.06372000000000E+03,-0.001129,2.866562},
    {2.11717000000000E+03,-0.000938,2.461656},
    {2.17997000000000E+03,-0.000774,2.103638},
    {2.24543000000000E+03,-0.000640,1.803888},
    {2.30533000000000E+03,-0.000555,1.606197},
    {2.33918000000000E+03,-0.000519,1.521973},
    {2.37900000000000E+03,-0.000446,1.349612},
    {2.44255000000000E+03,-0.000379,1.186209},
    {2.51962000000000E+03,-0.000314,1.022210},
    {2.60070000000000E+03,-0.000269,0.904958},
    {2.68117000000000E+03,-0.000231,0.803126},
    {2.76689000000000E+03,-0.000189,0.685487},
    {2.85542000000000E+03,-0.000163,0.612882},
    {2.96531000000000E+03,-0.000133,0.524520},
    {3.08736000000000E+03,-0.000110,0.452659},
    {3.23269000000000E+03,-0.000086,0.374694},
    {3.37048000000000E+03,-0.000072,0.325704},
    {3.50987000000000E+03,-0.000057,0.274284},
    {3.68846000000000E+03,-0.000046,0.233638},
    {3.84892000000000E+03,-0.000037,0.198371},
    {3.97983000000000E+03,-0.000033,0.181857},
    {4.10356000000000E+03,-0.000025,0.150665},
    {4.29915000000000E+03,-0.000021,0.135634},
    {4.44334000000000E+03,-0.000022,0.137367},
    {4.58872000000000E+03,-0.000017,0.116781},
    {4.75750000000000E+03,-0.000015,0.103708},
    {5.02345000000000E+03,-0.000012,0.088531},
    {5.20600000000000E+03,-0.000011,0.084028},
    {5.41330000000000E+03,-0.000009,0.076140},
    {5.63890000000000E+03,-0.000008,0.068226},
    {5.86967000000000E+03,-0.000006,0.058708},
    {6.16410000000000E+03,-0.000005,0.049385},
    {6.44140000000000E+03,-0.000004,0.046383}
  };

  unsigned long nMxb= (unsigned long) (sizeof(mxb)/sizeof(double))/3;
  printf("sizeof(mxb) / sizeof(double) = %lu\n",nMxb);

  //get interpolated y value for independent x
  double x=1170.;
  double y=interpolate(x, mxb, nMxb);

  printf("f(%f)=%f\n",x,y);

  return 0;
}
