#include<stdio.h>
//interpolateDataPoints.c

//return interpolated value
long double interpolate(long double x, long double mxb[][3], unsigned long int nMxb){
  //return 0 if x is not in bounds, assuming points are ordered
  if(x<mxb[0][0] || x>mxb[nMxb-1][0])
    return 0;

  //find the region boundary to the left of x
  int lowerXBoundaryIndex=0;
  while(x>=mxb[lowerXBoundaryIndex+1][0]) //lowerXBoundaryIndex+1 = upper bound index
    lowerXBoundaryIndex++;

  //y=mx+b
  long double m=mxb[lowerXBoundaryIndex][1];
  long double b=mxb[lowerXBoundaryIndex][2];

  return m*x+b;
}

float avs47(float resistance){
  //set slope/intercepts for y=mx+b fit for every set of calibrated points
  //{<min resistance range>, <slope>, <intercept>}
  long double mxb[][3]={
    {1.15866529715041E+03,-3.403151e-01,4.393414e+02},
    {1.16746663791400E+03,-3.085394e-01,4.022443e+02},
    {1.17721235255750E+03,-2.784618e-01,3.668366e+02},
    {1.18800973618585E+03,-2.550096e-01,3.389751e+02},
    {1.19978259001363E+03,-2.286341e-01,3.073303e+02},
    {1.20900330938726E+03,-2.141164e-01,2.897783e+02},
    {1.21743885586541E+03,-1.998052e-01,2.723553e+02},
    {1.22550149791847E+03,-1.851275e-01,2.543677e+02},
    {1.23416244962562E+03,-1.720622e-01,2.382431e+02},
    {1.24339517040247E+03,-1.616607e-01,2.253099e+02},
    {1.25325132686766E+03,-1.482423e-01,2.084934e+02},
    {1.26396964606193E+03,-1.360879e-01,1.931305e+02},
    {1.27187950977041E+03,-1.310061e-01,1.866671e+02},
    {1.27936384189714E+03,-1.244481e-01,1.782770e+02},
    {1.28722934127037E+03,-1.154188e-01,1.666542e+02},
    {1.29574759047070E+03,-1.106522e-01,1.604779e+02},
    {1.30462105050847E+03,-1.011578e-01,1.480914e+02},
    {1.31442017104110E+03,-9.648578e-02,1.419503e+02},
    {1.32472218300874E+03,-8.914946e-02,1.322317e+02},
    {1.33594976105827E+03,-8.258875e-02,1.234670e+02},
    {1.34817125459252E+03,-7.641321e-02,1.151413e+02},
    {1.36144449280113E+03,-7.011807e-02,1.065708e+02},
    {1.37599419281473E+03,-6.436564e-02,9.865547e+01},
    {1.39183479639045E+03,-5.765102e-02,8.930983e+01},
    {1.40954426489785E+03,-5.058641e-02,7.935196e+01},
    {1.42966395040817E+03,-4.416690e-02,7.017422e+01},
    {1.44803071964235E+03,-3.878814e-02,6.238560e+01},
    {1.46639736561052E+03,-3.365041e-02,5.485164e+01},
    {1.48143361599810E+03,-3.027032e-02,4.984426e+01},
    {1.49482205096690E+03,-2.699430e-02,4.494719e+01},
    {1.50928139937351E+03,-2.500093e-02,4.193864e+01},
    {1.51749647765215E+03,-2.334678e-02,3.942847e+01},
    {1.52600538164916E+03,-2.154028e-02,3.667175e+01},
    {1.53504308357240E+03,-1.965678e-02,3.378050e+01},
    {1.54521806346207E+03,-1.876556e-02,3.240337e+01},
    {1.55621166365908E+03,-1.706464e-02,2.975638e+01},
    {1.56790219236253E+03,-1.539696e-02,2.714162e+01},
    {1.58077863430236E+03,-1.392280e-02,2.481130e+01},
    {1.59568104326293E+03,-1.248037e-02,2.250963e+01},
    {1.61102290744041E+03,-1.107604e-02,2.024722e+01},
    {1.62935054078325E+03,-9.766669e-03,1.811380e+01},
    {1.64976915441758E+03,-8.410550e-03,1.587652e+01},
    {1.67349179538564E+03,-7.134181e-03,1.374053e+01},
    {1.70155732512926E+03,-5.854347e-03,1.156282e+01},
    {1.73591860654589E+03,-5.042769e-03,1.015398e+01},
    {1.75474906703357E+03,-4.532838e-03,9.259182e+00},
    {1.77769752561913E+03,-4.016819e-03,8.341857e+00},
    {1.79063000000000E+03,-3.608568e-03,7.610830e+00},
    {1.81829000000000E+03,-3.165684e-03,6.805538e+00},
    {1.84970000000000E+03,-2.745020e-03,6.027435e+00},
    {1.88391000000000E+03,-2.306544e-03,5.201386e+00},
    {1.92307000000000E+03,-1.973560e-03,4.561036e+00},
    {1.96321000000000E+03,-1.644213e-03,3.914458e+00},
    {2.00894000000000E+03,-1.381425e-03,3.386532e+00},
    {2.06372000000000E+03,-1.129466e-03,2.866559e+00},
    {2.11717000000000E+03,-9.382188e-04,2.461657e+00},
    {2.17997000000000E+03,-7.739874e-04,2.103637e+00},
    {2.24543000000000E+03,-6.404957e-04,1.803891e+00},
    {2.30533000000000E+03,-5.547372e-04,1.606189e+00},
    {2.33918000000000E+03,-5.187356e-04,1.521975e+00},
    {2.37900000000000E+03,-4.462844e-04,1.349614e+00},
    {2.44255000000000E+03,-3.793851e-04,1.186209e+00},
    {2.51962000000000E+03,-3.142956e-04,1.022208e+00},
    {2.60070000000000E+03,-2.692112e-04,9.049573e-01},
    {2.68117000000000E+03,-2.312309e-04,8.031255e-01},
    {2.76689000000000E+03,-1.887144e-04,6.854871e-01},
    {2.85542000000000E+03,-1.632873e-04,6.128821e-01},
    {2.96531000000000E+03,-1.334887e-04,5.245201e-01},
    {3.08736000000000E+03,-1.102127e-04,4.526585e-01},
    {3.23269000000000E+03,-8.609506e-05,3.746937e-01},
    {3.37048000000000E+03,-7.156024e-05,3.257044e-01},
    {3.50987000000000E+03,-5.690992e-05,2.742837e-01},
    {3.68846000000000E+03,-4.589014e-05,2.336377e-01},
    {3.84892000000000E+03,-3.672758e-05,1.983717e-01},
    {3.97983000000000E+03,-3.257796e-05,1.818569e-01},
    {4.10356000000000E+03,-2.497666e-05,1.506645e-01},
    {4.29915000000000E+03,-2.148060e-05,1.356345e-01},
    {4.44334000000000E+03,-2.187057e-05,1.373672e-01},
    {4.58872000000000E+03,-1.738425e-05,1.167808e-01},
    {4.75750000000000E+03,-1.463651e-05,1.037084e-01},
    {5.02345000000000E+03,-1.161521e-05,8.853103e-02},
    {5.20600000000000E+03,-1.075024e-05,8.402797e-02},
    {5.41330000000000E+03,-9.293147e-06,7.614031e-02},
    {5.63890000000000E+03,-7.889583e-06,6.822575e-02},
    {5.86967000000000E+03,-6.268043e-06,5.870785e-02},
    {6.16410000000000E+03,-4.755662e-06,4.938537e-02},
    {6.44140000000000E+03,-4.289617e-06,4.638340e-02}
  };

  unsigned long nMxb= (unsigned long) (sizeof(mxb)/sizeof(long double))/3;

  //get interpolated y value for independent x
  long double x = (long double) resistance;
  long double y = interpolate(x, mxb, nMxb);

  //cast to a float for database call
  float temperature = (float) y;
  return temperature;
}

int main(){
  float r=5400.;
  printf("T(%f) = %f K\n",r,avs47(r));
  return 0;
}
